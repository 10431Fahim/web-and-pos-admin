<section class="page-header-section">
  <div class="page-header-card">
    <div class="header-content">
      <div class="header-title">
        <h1 class="page-title">
          <mat-icon class="title-icon">star</mat-icon>
          Top Selling Products
        </h1>
      </div>
    </div>
  </div>
</section>

<section class="filter-section">
  <div class="filter-card">
    <div class="filter-content">
      <div class="date-filter-container">
        <mat-form-field
          class="date-filter-field"
          appearance="outline"
          (click)="picker.open()"
        >
          <mat-label>Date Range</mat-label>
          <mat-date-range-input
            [formGroup]="dataFormDateRange"
            [rangePicker]="picker"
            [max]="today"
          >
            <input
              matStartDate
              formControlName="start"
              placeholder="Start date"
              readonly
            />
            <input
              matEndDate
              formControlName="end"
              placeholder="End date"
              readonly
              (dateChange)="endChangeRegDateRange($event)"
            />
          </mat-date-range-input>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-date-range-picker #picker></mat-date-range-picker>
        </mat-form-field>
      </div>
      <mat-form-field appearance="outline">
        <mat-label>Limit</mat-label>
        <input matInput type="number" [(ngModel)]="limit" (ngModelChange)="onLimitChange()" min="1" max="100">
      </mat-form-field>
    </div>
    <div class="export-toolbar" *ngIf="!isLoading && topProducts.length > 0">
      <button
        mat-stroked-button
        class="export-btn"
        (click)="exportCSV()"
        matTooltip="Export CSV">
        <mat-icon>description</mat-icon>
        <span>Export CSV</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="exportExcel()"
        matTooltip="Export Excel">
        <mat-icon>table_chart</mat-icon>
        <span>Export Excel</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="printReport()"
        matTooltip="Print">
        <mat-icon>print</mat-icon>
        <span>Print</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="showColumnsInfo()"
        matTooltip="Columns">
        <mat-icon>view_column</mat-icon>
        <span>Columns</span>
      </button>

      <button
        mat-stroked-button
        class="export-btn"
        (click)="exportPDF()"
        matTooltip="Export PDF">
        <mat-icon>picture_as_pdf</mat-icon>
        <span>Export PDF</span>
      </button>
    </div>
  </div>
</section>

<app-page-loader *ngIf="isLoading"></app-page-loader>

<section class="table-section" *ngIf="!isLoading && topProducts.length > 0">
  <div class="table-card">
    <div class="table-responsive">
      <table class="modern-table">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Product Name</th>
            <th>SKU</th>
            <th>Quantity Sold</th>
            <th>Total Sale Amount</th>
            <th>Average Price</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of topProducts; let i = index" class="table-row">
            <td>
              <span class="rank-badge" [ngClass]="{'rank-1': i === 0, 'rank-2': i === 1, 'rank-3': i === 2}">
                {{ i + 1 }}
              </span>
            </td>
            <td>{{ product.productName || 'N/A' }}</td>
            <td>{{ product.sku || '-' }}</td>
            <td><strong>{{ product.totalQuantity }}</strong></td>
            <td><strong class="positive">{{ product.totalSaleAmount | currency:'BDT ':'symbol':'1.2-2' }}</strong></td>
            <td>{{ product.averagePrice | currency:'BDT ':'symbol':'1.2-2' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<app-no-content *ngIf="!isLoading && topProducts.length === 0" [text]="'No data found'"></app-no-content>

